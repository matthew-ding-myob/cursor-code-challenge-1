<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Not a Flappy Bird clone</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
        canvas {
            display: block;
        }
    </style>
</head>
<body>
    <canvas id="backgroundCanvas"></canvas>
    <script>
        const canvas = document.getElementById('backgroundCanvas');
        const ctx = canvas.getContext('2d');

        // Set canvas size to fill the window
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        const backgroundImage = new Image();
        backgroundImage.src = '../assets/city_background.png';

        const cassowaryImage = new Image();
        cassowaryImage.src = '../assets/cassowary.png';

        const coinImage = new Image();
        coinImage.src = '../assets/coin.png';

        const seagullImage = new Image();
        seagullImage.src = '../assets/seagull.png';

        let cassowaryY = (canvas.height - cassowaryImage.height * 0.8) / 2;
        let isJumping = false;
        let jumpVelocity = 0;
        const gravity = 0.5;
        const maxJumpHeight = (canvas.height - cassowaryImage.height * 0.8) / 2 - 100;

        document.addEventListener('keydown', (event) => {
            if (event.code === 'Space' && !isJumping) {
                isJumping = true;
                jumpVelocity = -15; // Increased initial jump velocity for higher jump
            }
        });

        function updateCassowaryPosition() {
            if (isJumping) {
                cassowaryY += jumpVelocity;
                jumpVelocity += gravity;

                // Stop jumping when cassowary returns to original position
                const originalY = (canvas.height - cassowaryImage.height * 0.8) / 2;
                if (cassowaryY >= originalY) {
                    cassowaryY = originalY;
                    isJumping = false;
                }
            }
        }

        class BackgroundInstance {
            constructor(x) {
                this.x = x;
                this.coinPositions = this.generateRandomCoinPositions();
                this.seagullPositions = this.generateRandomSeagullPositions();
            }

            generateRandomCoinPositions() {
                const positions = [];
                let lastX = this.x;
                const maxDistance = backgroundImage.width * 2.5 / 5; // Spread coins evenly across the background

                for (let i = 0; i < 5; i++) {
                    lastX += Math.random() * (maxDistance - coinImage.width * 0.5) + coinImage.width * 0.5 + 50; // Ensure spacing and no overlap
                    positions.push(lastX);
                }

                return positions;
            }

            generateRandomSeagullPositions() {
                const positions = [];
                let lastX = this.x;
                const maxDistance = backgroundImage.width * 2.5 / 3; // Spread seagulls evenly across the background

                for (let i = 0; i < 3; i++) {
                    lastX += Math.random() * (maxDistance - seagullImage.width * 0.25) + seagullImage.width * 0.25 + 50; // Ensure spacing and no overlap
                    positions.push(lastX);
                }

                return positions;
            }

            drawSeagulls() {
                this.seagullPositions.forEach((x) => {
                    const seagullY = (canvas.height - seagullImage.height * 0.2) / 2; // Adjusted scale to 0.2x
                    ctx.drawImage(seagullImage, x, seagullY, seagullImage.width * 0.2, seagullImage.height * 0.2); // Scale seagulls to 0.2x
                });
            }

            drawCoins() {
                this.coinPositions.forEach((x) => {
                    const coinY = maxJumpHeight - 20; // Move coins slightly upwards
                    ctx.drawImage(coinImage, x, coinY, coinImage.width * 0.4, coinImage.height * 0.4); // Scale coins to 0.4x (0.8x smaller)
                });
            }

            updatePosition(speed) {
                this.x -= speed;
                this.coinPositions = this.coinPositions.map((x) => x - speed);
                this.seagullPositions = this.seagullPositions.map((x) => x - speed); // Move seagulls with the background

                // Regenerate seagulls when the background is reset
                if (this.x + backgroundImage.width * 2.5 <= 0) {
                    this.seagullPositions = this.generateRandomSeagullPositions();
                }
            }
        }

        let backgroundInstances = [];

        function initializeBackgroundInstances() {
            backgroundInstances = [
                new BackgroundInstance(0),
                new BackgroundInstance(backgroundImage.width * 2.5)
            ];
        }

        function drawBackground() {
            backgroundInstances.forEach((instance) => {
                ctx.drawImage(backgroundImage, instance.x, 0, backgroundImage.width * 2.5, backgroundImage.height * 1.5);
                instance.drawCoins();
                instance.drawSeagulls();
            });
        }

        function updateBackground(speed) {
            backgroundInstances.forEach((instance) => {
                instance.updatePosition(speed);
            });

            // Reset positions and regenerate coins when off-screen
            if (backgroundInstances[0].x + backgroundImage.width * 2.5 <= 0) {
                const lastInstance = backgroundInstances[backgroundInstances.length - 1];
                backgroundInstances.shift();
                backgroundInstances.push(new BackgroundInstance(lastInstance.x + backgroundImage.width * 2.5));
            }
        }

        backgroundImage.onload = () => {
            cassowaryImage.onload = () => {
                initializeBackgroundInstances();

                function draw() {
                    ctx.clearRect(0, 0, canvas.width, canvas.height);

                    // Draw and update background with coins
                    drawBackground();
                    updateBackground(2);

                    // Update cassowary position
                    updateCassowaryPosition();

                    // Draw the cassowary image
                    const cassowaryWidth = cassowaryImage.width;
                    const cassowaryHeight = cassowaryImage.height;
                    const cassowaryX = (canvas.width / 3 - cassowaryWidth) / 2;
                    ctx.drawImage(cassowaryImage, cassowaryX, cassowaryY, cassowaryWidth, cassowaryHeight);

                    requestAnimationFrame(draw);
                }

                draw();
            };
        };

        // Adjust canvas size on window resize
        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
        });
    </script>
</body>
</html>